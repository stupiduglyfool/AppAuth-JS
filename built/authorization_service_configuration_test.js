"use strict";
/*
 * Copyright 2017 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the
 * License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing permissions and
 * limitations under the License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
var authorization_service_configuration_1 = require("./authorization_service_configuration");
var xhr_1 = require("./xhr");
describe('Authorization Service Configuration Tests', function () {
    var authorizationEndpoint = 'authorization://endpoint';
    var tokenEndpoint = 'token://endpoint';
    var revocationEndpoint = 'revocation://endpoint';
    it('Initialization should work', function () {
        var configuration = new authorization_service_configuration_1.AuthorizationServiceConfiguration(authorizationEndpoint, tokenEndpoint, revocationEndpoint);
        expect(configuration).toBeTruthy();
        expect(configuration.authorizationEndpoint).toBe(authorizationEndpoint);
        expect(configuration.tokenEndpoint).toBe(tokenEndpoint);
        expect(configuration.revocationEndpoint).toBe(revocationEndpoint);
    });
    it('Conversion to Json and back should work', function () {
        var configuration = new authorization_service_configuration_1.AuthorizationServiceConfiguration(authorizationEndpoint, tokenEndpoint, revocationEndpoint);
        var json = configuration.toJson();
        var newConfiguration = authorization_service_configuration_1.AuthorizationServiceConfiguration.fromJson(json);
        expect(newConfiguration).toBeTruthy();
        expect(newConfiguration.authorizationEndpoint).toBe(configuration.authorizationEndpoint);
        expect(newConfiguration.tokenEndpoint).toBe(configuration.tokenEndpoint);
        expect(newConfiguration.revocationEndpoint).toBe(configuration.revocationEndpoint);
    });
    describe('Tests with dependencies', function () {
        it('Fetch from issuer tests should work', function (done) {
            var configuration = new authorization_service_configuration_1.AuthorizationServiceConfiguration(authorizationEndpoint, tokenEndpoint, revocationEndpoint);
            var promise = Promise.resolve(configuration.toJson());
            var requestor = new xhr_1.TestRequestor(promise);
            authorization_service_configuration_1.AuthorizationServiceConfiguration.fetchFromIssuer('some://endpoint', requestor)
                .then(function (result) {
                expect(result).toBeTruthy();
                expect(result.authorizationEndpoint)
                    .toBe(configuration.authorizationEndpoint);
                expect(result.tokenEndpoint).toBe(configuration.tokenEndpoint);
                expect(result.revocationEndpoint).toBe(configuration.revocationEndpoint);
                done();
            });
        });
        it('Fetch from issuer tests should work', function (done) {
            var promise = Promise.reject(new Error('Something bad happened.'));
            var requestor = new xhr_1.TestRequestor(promise);
            authorization_service_configuration_1.AuthorizationServiceConfiguration.fetchFromIssuer('some://endpoint', requestor)
                .catch(function (result) {
                expect(result).toBeTruthy();
                var error = result;
                expect(error.message).toBe('Something bad happened.');
                done();
            });
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aG9yaXphdGlvbl9zZXJ2aWNlX2NvbmZpZ3VyYXRpb25fdGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9hdXRob3JpemF0aW9uX3NlcnZpY2VfY29uZmlndXJhdGlvbl90ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7O0dBWUc7O0FBRUgsNkZBQStIO0FBRS9ILDZCQUFvQztBQUVwQyxRQUFRLENBQUMsMkNBQTJDLEVBQUU7SUFFakQsSUFBTSxxQkFBcUIsR0FBRywwQkFBMEIsQ0FBQTtJQUN4RCxJQUFNLGFBQWEsR0FBRyxrQkFBa0IsQ0FBQztJQUN6QyxJQUFNLGtCQUFrQixHQUFHLHVCQUF1QixDQUFDO0lBRW5ELEVBQUUsQ0FBQyw0QkFBNEIsRUFBRTtRQUM1QixJQUFJLGFBQWEsR0FBRyxJQUFJLHVFQUFpQyxDQUNyRCxxQkFBcUIsRUFBRSxhQUFhLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztRQUU5RCxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDbkMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQ3hFLE1BQU0sQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3hELE1BQU0sQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUN2RSxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyx5Q0FBeUMsRUFBRTtRQUN6QyxJQUFJLGFBQWEsR0FBRyxJQUFJLHVFQUFpQyxDQUNyRCxxQkFBcUIsRUFBRSxhQUFhLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztRQUU5RCxJQUFJLElBQUksR0FBRyxhQUFhLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDbEMsSUFBSSxnQkFBZ0IsR0FBRyx1RUFBaUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEUsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDdEMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLHFCQUFxQixDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQ3pGLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3pFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUN4RixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyx5QkFBeUIsRUFBRTtRQUUvQixFQUFFLENBQUMscUNBQXFDLEVBQUUsVUFBQyxJQUFZO1lBQ2xELElBQUksYUFBYSxHQUFHLElBQUksdUVBQWlDLENBQ3JELHFCQUFxQixFQUFFLGFBQWEsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1lBQzlELElBQUksT0FBTyxHQUNQLE9BQU8sQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFDNUMsSUFBSSxTQUFTLEdBQUcsSUFBSSxtQkFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzNDLHVFQUFpQyxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsRUFBRSxTQUFTLENBQUM7aUJBQzFFLElBQUksQ0FBQyxVQUFBLE1BQU07Z0JBQ1AsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO2dCQUM1QixNQUFNLENBQUMsTUFBTSxDQUFDLHFCQUFxQixDQUFDO3FCQUMvQixJQUFJLENBQUMsYUFBYSxDQUFDLHFCQUFxQixDQUFDLENBQUM7Z0JBQy9DLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsQ0FBQztnQkFDL0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUMsQ0FBQztnQkFDekUsSUFBSSxFQUFFLENBQUM7WUFDWixDQUFDLENBQUMsQ0FBQztRQUNaLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLFVBQUMsSUFBWTtZQUNsRCxJQUFJLE9BQU8sR0FDUCxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUMsQ0FBQztZQUN6RCxJQUFJLFNBQVMsR0FBRyxJQUFJLG1CQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFM0MsdUVBQWlDLENBQUMsZUFBZSxDQUFDLGlCQUFpQixFQUFFLFNBQVMsQ0FBQztpQkFDMUUsS0FBSyxDQUFDLFVBQUEsTUFBTTtnQkFDUixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7Z0JBQzVCLElBQUksS0FBSyxHQUFHLE1BQXNCLENBQUM7Z0JBQ25DLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQUM7Z0JBQ3RELElBQUksRUFBRSxDQUFDO1lBQ1osQ0FBQyxDQUFDLENBQUM7UUFDWixDQUFDLENBQUMsQ0FBQztJQUVSLENBQUMsQ0FBQyxDQUFDO0FBRVIsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgSW5jLlxyXG4gKlxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdFxyXG4gKiBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxyXG4gKlxyXG4gKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcclxuICpcclxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGVcclxuICogTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXJcclxuICogZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXHJcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7QXV0aG9yaXphdGlvblNlcnZpY2VDb25maWd1cmF0aW9uLCBBdXRob3JpemF0aW9uU2VydmljZUNvbmZpZ3VyYXRpb25Kc29ufSBmcm9tICcuL2F1dGhvcml6YXRpb25fc2VydmljZV9jb25maWd1cmF0aW9uJztcclxuaW1wb3J0IHtBcHBBdXRoRXJyb3J9IGZyb20gJy4vZXJyb3JzJztcclxuaW1wb3J0IHtUZXN0UmVxdWVzdG9yfSBmcm9tICcuL3hocic7XHJcblxyXG5kZXNjcmliZSgnQXV0aG9yaXphdGlvbiBTZXJ2aWNlIENvbmZpZ3VyYXRpb24gVGVzdHMnLCAoKSA9PiB7XHJcblxyXG4gICAgIGNvbnN0IGF1dGhvcml6YXRpb25FbmRwb2ludCA9ICdhdXRob3JpemF0aW9uOi8vZW5kcG9pbnQnXHJcbiAgICAgY29uc3QgdG9rZW5FbmRwb2ludCA9ICd0b2tlbjovL2VuZHBvaW50JztcclxuICAgICBjb25zdCByZXZvY2F0aW9uRW5kcG9pbnQgPSAncmV2b2NhdGlvbjovL2VuZHBvaW50JztcclxuXHJcbiAgICAgaXQoJ0luaXRpYWxpemF0aW9uIHNob3VsZCB3b3JrJywgKCkgPT4ge1xyXG4gICAgICAgICAgbGV0IGNvbmZpZ3VyYXRpb24gPSBuZXcgQXV0aG9yaXphdGlvblNlcnZpY2VDb25maWd1cmF0aW9uKFxyXG4gICAgICAgICAgICAgIGF1dGhvcml6YXRpb25FbmRwb2ludCwgdG9rZW5FbmRwb2ludCwgcmV2b2NhdGlvbkVuZHBvaW50KTtcclxuXHJcbiAgICAgICAgICBleHBlY3QoY29uZmlndXJhdGlvbikudG9CZVRydXRoeSgpO1xyXG4gICAgICAgICAgZXhwZWN0KGNvbmZpZ3VyYXRpb24uYXV0aG9yaXphdGlvbkVuZHBvaW50KS50b0JlKGF1dGhvcml6YXRpb25FbmRwb2ludCk7XHJcbiAgICAgICAgICBleHBlY3QoY29uZmlndXJhdGlvbi50b2tlbkVuZHBvaW50KS50b0JlKHRva2VuRW5kcG9pbnQpO1xyXG4gICAgICAgICAgZXhwZWN0KGNvbmZpZ3VyYXRpb24ucmV2b2NhdGlvbkVuZHBvaW50KS50b0JlKHJldm9jYXRpb25FbmRwb2ludCk7XHJcbiAgICAgfSk7XHJcblxyXG4gICAgIGl0KCdDb252ZXJzaW9uIHRvIEpzb24gYW5kIGJhY2sgc2hvdWxkIHdvcmsnLCAoKSA9PiB7XHJcbiAgICAgICAgICBsZXQgY29uZmlndXJhdGlvbiA9IG5ldyBBdXRob3JpemF0aW9uU2VydmljZUNvbmZpZ3VyYXRpb24oXHJcbiAgICAgICAgICAgICAgYXV0aG9yaXphdGlvbkVuZHBvaW50LCB0b2tlbkVuZHBvaW50LCByZXZvY2F0aW9uRW5kcG9pbnQpO1xyXG5cclxuICAgICAgICAgIGxldCBqc29uID0gY29uZmlndXJhdGlvbi50b0pzb24oKTtcclxuICAgICAgICAgIGxldCBuZXdDb25maWd1cmF0aW9uID0gQXV0aG9yaXphdGlvblNlcnZpY2VDb25maWd1cmF0aW9uLmZyb21Kc29uKGpzb24pO1xyXG4gICAgICAgICAgZXhwZWN0KG5ld0NvbmZpZ3VyYXRpb24pLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICAgIGV4cGVjdChuZXdDb25maWd1cmF0aW9uLmF1dGhvcml6YXRpb25FbmRwb2ludCkudG9CZShjb25maWd1cmF0aW9uLmF1dGhvcml6YXRpb25FbmRwb2ludCk7XHJcbiAgICAgICAgICBleHBlY3QobmV3Q29uZmlndXJhdGlvbi50b2tlbkVuZHBvaW50KS50b0JlKGNvbmZpZ3VyYXRpb24udG9rZW5FbmRwb2ludCk7XHJcbiAgICAgICAgICBleHBlY3QobmV3Q29uZmlndXJhdGlvbi5yZXZvY2F0aW9uRW5kcG9pbnQpLnRvQmUoY29uZmlndXJhdGlvbi5yZXZvY2F0aW9uRW5kcG9pbnQpO1xyXG4gICAgIH0pO1xyXG5cclxuICAgICBkZXNjcmliZSgnVGVzdHMgd2l0aCBkZXBlbmRlbmNpZXMnLCAoKSA9PiB7XHJcblxyXG4gICAgICAgICAgaXQoJ0ZldGNoIGZyb20gaXNzdWVyIHRlc3RzIHNob3VsZCB3b3JrJywgKGRvbmU6IERvbmVGbikgPT4ge1xyXG4gICAgICAgICAgICAgICBsZXQgY29uZmlndXJhdGlvbiA9IG5ldyBBdXRob3JpemF0aW9uU2VydmljZUNvbmZpZ3VyYXRpb24oXHJcbiAgICAgICAgICAgICAgICAgICBhdXRob3JpemF0aW9uRW5kcG9pbnQsIHRva2VuRW5kcG9pbnQsIHJldm9jYXRpb25FbmRwb2ludCk7XHJcbiAgICAgICAgICAgICAgIGxldCBwcm9taXNlOiBQcm9taXNlPEF1dGhvcml6YXRpb25TZXJ2aWNlQ29uZmlndXJhdGlvbkpzb24+ID1cclxuICAgICAgICAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZShjb25maWd1cmF0aW9uLnRvSnNvbigpKTtcclxuICAgICAgICAgICAgICAgbGV0IHJlcXVlc3RvciA9IG5ldyBUZXN0UmVxdWVzdG9yKHByb21pc2UpO1xyXG4gICAgICAgICAgICAgICBBdXRob3JpemF0aW9uU2VydmljZUNvbmZpZ3VyYXRpb24uZmV0Y2hGcm9tSXNzdWVyKCdzb21lOi8vZW5kcG9pbnQnLCByZXF1ZXN0b3IpXHJcbiAgICAgICAgICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlVHJ1dGh5KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChyZXN1bHQuYXV0aG9yaXphdGlvbkVuZHBvaW50KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRvQmUoY29uZmlndXJhdGlvbi5hdXRob3JpemF0aW9uRW5kcG9pbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBlY3QocmVzdWx0LnRva2VuRW5kcG9pbnQpLnRvQmUoY29uZmlndXJhdGlvbi50b2tlbkVuZHBvaW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJlc3VsdC5yZXZvY2F0aW9uRW5kcG9pbnQpLnRvQmUoY29uZmlndXJhdGlvbi5yZXZvY2F0aW9uRW5kcG9pbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkb25lKCk7XHJcbiAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIGl0KCdGZXRjaCBmcm9tIGlzc3VlciB0ZXN0cyBzaG91bGQgd29yaycsIChkb25lOiBEb25lRm4pID0+IHtcclxuICAgICAgICAgICAgICAgbGV0IHByb21pc2U6IFByb21pc2U8QXV0aG9yaXphdGlvblNlcnZpY2VDb25maWd1cmF0aW9uSnNvbj4gPVxyXG4gICAgICAgICAgICAgICAgICAgUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdTb21ldGhpbmcgYmFkIGhhcHBlbmVkLicpKTtcclxuICAgICAgICAgICAgICAgbGV0IHJlcXVlc3RvciA9IG5ldyBUZXN0UmVxdWVzdG9yKHByb21pc2UpO1xyXG5cclxuICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvblNlcnZpY2VDb25maWd1cmF0aW9uLmZldGNoRnJvbUlzc3Vlcignc29tZTovL2VuZHBvaW50JywgcmVxdWVzdG9yKVxyXG4gICAgICAgICAgICAgICAgICAgLmNhdGNoKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVUcnV0aHkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGVycm9yID0gcmVzdWx0IGFzIEFwcEF1dGhFcnJvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQmUoJ1NvbWV0aGluZyBiYWQgaGFwcGVuZWQuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcclxuICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgIH0pO1xyXG5cclxufSk7XHJcbiJdfQ==